#> fetchr:item_detection/announce
#
# This function is called to announce the item get of the current item.
#
# It also announces reaching a goal, when applicable
#
# @within function fetchr:item_detection/check_and_announce

#>
# Storage that holds information about the currently selected slot
#
# @internal
#declare storage tmp.fetchr:item_detection

#>
# @private
#declare score_holder $item_detect/announce.has_bingo
#>
# @within
# 	function fetchr:item_detection/**
#declare score_holder $item_detect/announce.items

execute in fetchr:lobby run function neun_einser.timer:store_current_time
scoreboard players reset @s fetchr.has_item
tag @s add fetchr.clear

# Update item count
execute store result score $item_detect/announce.items fetchr.tmp run data get storage fetchr:card teams[-1].itemCount
scoreboard players add $item_detect/announce.items fetchr.tmp 1
execute store result storage fetchr:card teams[-1].itemCount int 1 run scoreboard players get $item_detect/announce.items fetchr.tmp

execute as @a[tag=fetchr.in_current_team] at @s run playsound minecraft:block.end_portal_frame.fill voice @s ~ ~ ~ 1 2
tellraw @a ["[", {"text":"â‰¡", "color":"#00c3ff", "clickEvent":{"action":"run_command", "value":"/trigger fetchr.menu"}, "hoverEvent":{"action":"show_text", "contents":{"translate": "fetchr.game.menu.hover_text"}}}, "] ", {"translate": "fetchr.got_item", "with": [{"score": {"name": "$item_detect/announce.items", "objective": "fetchr.tmp"}}, {"storage": "neun_einser.timer:display", "nbt": "\"hh:mm:ss.s\"", "interpret": true}, {"selector": "@s"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.textComponent", "interpret": true}]}]

execute store result score $item_detect/announce.has_bingo fetchr.tmp run data get storage fetchr:card teams[-1].hasBingo

# Update completed indicator
execute store result score $item_detect/announce.background_index fetchr.tmp run data get storage fetchr:card teams[-1].backgroundIndex
data modify storage tmp.fetchr:item_detection skippedBackgrounds set value []
function fetchr:item_detection/find_background
data modify storage tmp.fetchr:item_detection slot.background prepend from storage fetchr:card teams[-1].background
data modify storage tmp.fetchr:item_detection slot.background prepend from storage tmp.fetchr:item_detection skippedBackgrounds[]

execute if score $team_count fetchr.state matches 1 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 2 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 3 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 4 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 5 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 6 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 7 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 8 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 9 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[8]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 10 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[8]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[9]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 11 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[8]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[9]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[10]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 12 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[8]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[9]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[10]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[11]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 13 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[8]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[9]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[10]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[11]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[12]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 14 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[8]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[9]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[10]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[11]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[12]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[13]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 15 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[8]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[9]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[10]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[11]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[12]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[13]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[14]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
execute if score $team_count fetchr.state matches 16 run data modify block 7 0 7 Text1 set value '["", {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[0]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[1]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[2]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[3]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[4]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[5]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[6]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[7]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[8]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[9]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[10]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[11]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[12]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[13]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[14]", "interpret": true}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.background[15]", "interpret": true}, {"text": "\\u0002", "font": "fetchr:space"}, {"storage": "tmp.fetchr:item_detection", "nbt": "slot.item.icon", "interpret": true}]'
data modify storage tmp.fetchr:item_detection slot.display set from block 7 0 7 Text1

# detect goals
execute if score $item_detect/announce.has_bingo fetchr.tmp matches 0 run function fetchr:item_detection/goals/bingo/detect_bingo_and_20_no_bingo
execute if score $item_detect/announce.items fetchr.tmp matches 25 run function fetchr:item_detection/goals/announce_blackout

scoreboard players set $update_card fetchr.state 1